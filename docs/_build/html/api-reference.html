
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>API Reference &#8212; Image-anonymisation 0 documentation</title>
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="README" href="readme.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="readme.html" title="README"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Image-anonymisation 0 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="api-reference">
<h1>API Reference<a class="headerlink" href="#api-reference" title="Permalink to this headline">¶</a></h1>
<div class="section" id="module-config">
<span id="config"></span><h2>config<a class="headerlink" href="#module-config" title="Permalink to this headline">¶</a></h2>
<p>Configuration variables.</p>
<dl class="data">
<dt id="config.log_level">
<code class="sig-prename descclassname">config.</code><code class="sig-name descname">log_level</code><em class="property"> = 'DEBUG'</em><a class="headerlink" href="#config.log_level" title="Permalink to this definition">¶</a></dt>
<dd><p>Logging level for the application. This controls the log level for terminal logging and file logging (if it is
enabled). Must be one of {“DEBUG”, “INFO”, “WARNING”, “ERROR”}.</p>
</dd></dl>

<dl class="data">
<dt id="config.draw_mask">
<code class="sig-prename descclassname">config.</code><code class="sig-name descname">draw_mask</code><em class="property"> = True</em><a class="headerlink" href="#config.draw_mask" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply the mask to the output image?</p>
</dd></dl>

<dl class="data">
<dt id="config.delete_input">
<code class="sig-prename descclassname">config.</code><code class="sig-name descname">delete_input</code><em class="property"> = False</em><a class="headerlink" href="#config.delete_input" title="Permalink to this definition">¶</a></dt>
<dd><p>Delete the original image from the input directory when the masking is completed?</p>
</dd></dl>

<dl class="data">
<dt id="config.force_remask">
<code class="sig-prename descclassname">config.</code><code class="sig-name descname">force_remask</code><em class="property"> = False</em><a class="headerlink" href="#config.force_remask" title="Permalink to this definition">¶</a></dt>
<dd><p>Recompute masks even though a .webp file exists in the input folder.</p>
</dd></dl>

<dl class="data">
<dt id="config.lazy_paths">
<code class="sig-prename descclassname">config.</code><code class="sig-name descname">lazy_paths</code><em class="property"> = False</em><a class="headerlink" href="#config.lazy_paths" title="Permalink to this definition">¶</a></dt>
<dd><p>When <cite>lazy_paths = True</cite>, traverse the file tree during the masking process.
Otherwise, all paths will be identified and stored before the masking starts.</p>
</dd></dl>

<dl class="data">
<dt id="config.file_access_retry_seconds">
<code class="sig-prename descclassname">config.</code><code class="sig-name descname">file_access_retry_seconds</code><em class="property"> = 10</em><a class="headerlink" href="#config.file_access_retry_seconds" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of seconds to wait before (re)trying to access a file/directory which cannot currently be reached. This
applies to both reading input files, and writing output files.</p>
</dd></dl>

<dl class="data">
<dt id="config.file_access_timeout_seconds">
<code class="sig-prename descclassname">config.</code><code class="sig-name descname">file_access_timeout_seconds</code><em class="property"> = 60</em><a class="headerlink" href="#config.file_access_timeout_seconds" title="Permalink to this definition">¶</a></dt>
<dd><p>Total number of seconds to wait before giving up on accessing a file/directory which cannot currently be reached.
This also applies to both reading input files, and writing output files.</p>
</dd></dl>

<dl class="data">
<dt id="config.datetime_format">
<code class="sig-prename descclassname">config.</code><code class="sig-name descname">datetime_format</code><em class="property"> = '%Y-%m-%d %H.%M.%S'</em><a class="headerlink" href="#config.datetime_format" title="Permalink to this definition">¶</a></dt>
<dd><p>Format of datetime identifiers. See <a class="reference external" href="https://docs.python.org/3.7/library/datetime.html#strftime-strptime-behavior">https://docs.python.org/3.7/library/datetime.html#strftime-strptime-behavior</a> for
more information.</p>
</dd></dl>

<dl class="data">
<dt id="config.log_file_name">
<code class="sig-prename descclassname">config.</code><code class="sig-name descname">log_file_name</code><em class="property"> = '{datetime} {hostname}.log'</em><a class="headerlink" href="#config.log_file_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Name of the log file. <cite>{datetime}</cite> will be replaced with a timestamp formatted as <cite>datetime_format</cite>. {hostname}
will be replaced with the host name.</p>
</dd></dl>

<dl class="data">
<dt id="config.enable_async">
<code class="sig-prename descclassname">config.</code><code class="sig-name descname">enable_async</code><em class="property"> = True</em><a class="headerlink" href="#config.enable_async" title="Permalink to this definition">¶</a></dt>
<dd><p>Enable asynchronous post-processing? When True, the file exports (anonymised image, mask file and JSON file) will be
executed asynchronously in order to increase processing speed.</p>
</dd></dl>

<dl class="data">
<dt id="config.max_num_async_workers">
<code class="sig-prename descclassname">config.</code><code class="sig-name descname">max_num_async_workers</code><em class="property"> = 2</em><a class="headerlink" href="#config.max_num_async_workers" title="Permalink to this definition">¶</a></dt>
<dd><p>Maximum number of asynchronous workers allowed to be active simultaneously. Should be &lt;= (CPU core count - 1)</p>
</dd></dl>

<dl class="data">
<dt id="config.uncaught_exception_email">
<code class="sig-prename descclassname">config.</code><code class="sig-name descname">uncaught_exception_email</code><em class="property"> = False</em><a class="headerlink" href="#config.uncaught_exception_email" title="Permalink to this definition">¶</a></dt>
<dd><p>Send an email if the program exits abnormally due to an uncaught exception.</p>
</dd></dl>

<dl class="data">
<dt id="config.processing_error_email">
<code class="sig-prename descclassname">config.</code><code class="sig-name descname">processing_error_email</code><em class="property"> = False</em><a class="headerlink" href="#config.processing_error_email" title="Permalink to this definition">¶</a></dt>
<dd><p>Send an email if a processing error is encountered, but the program is able to continue</p>
</dd></dl>

<dl class="data">
<dt id="config.finished_email">
<code class="sig-prename descclassname">config.</code><code class="sig-name descname">finished_email</code><em class="property"> = False</em><a class="headerlink" href="#config.finished_email" title="Permalink to this definition">¶</a></dt>
<dd><p>Send an email if the anonymisation finishes normally.</p>
</dd></dl>

<dl class="data">
<dt id="config.remote_json">
<code class="sig-prename descclassname">config.</code><code class="sig-name descname">remote_json</code><em class="property"> = True</em><a class="headerlink" href="#config.remote_json" title="Permalink to this definition">¶</a></dt>
<dd><p>Write the EXIF .json file to the output (remote) directory?</p>
</dd></dl>

<dl class="data">
<dt id="config.local_json">
<code class="sig-prename descclassname">config.</code><code class="sig-name descname">local_json</code><em class="property"> = False</em><a class="headerlink" href="#config.local_json" title="Permalink to this definition">¶</a></dt>
<dd><p>Write the EXIF .json file to the input (local) directory?</p>
</dd></dl>

<dl class="data">
<dt id="config.archive_json">
<code class="sig-prename descclassname">config.</code><code class="sig-name descname">archive_json</code><em class="property"> = False</em><a class="headerlink" href="#config.archive_json" title="Permalink to this definition">¶</a></dt>
<dd><p>Write the EXIF .json file to the archive directory?</p>
</dd></dl>

<dl class="data">
<dt id="config.remote_mask">
<code class="sig-prename descclassname">config.</code><code class="sig-name descname">remote_mask</code><em class="property"> = True</em><a class="headerlink" href="#config.remote_mask" title="Permalink to this definition">¶</a></dt>
<dd><p>Write mask file to the output (remote) directory?</p>
</dd></dl>

<dl class="data">
<dt id="config.local_mask">
<code class="sig-prename descclassname">config.</code><code class="sig-name descname">local_mask</code><em class="property"> = False</em><a class="headerlink" href="#config.local_mask" title="Permalink to this definition">¶</a></dt>
<dd><p>Write the mask file to the input (local) directory?</p>
</dd></dl>

<dl class="data">
<dt id="config.archive_mask">
<code class="sig-prename descclassname">config.</code><code class="sig-name descname">archive_mask</code><em class="property"> = False</em><a class="headerlink" href="#config.archive_mask" title="Permalink to this definition">¶</a></dt>
<dd><p>Write mask file to the archive directory?</p>
</dd></dl>

<dl class="data">
<dt id="config.model_type">
<code class="sig-prename descclassname">config.</code><code class="sig-name descname">model_type</code><em class="property"> = 'Medium'</em><a class="headerlink" href="#config.model_type" title="Permalink to this definition">¶</a></dt>
<dd><p>Type of masking model. Currently, there are three available models with varying speed and accuracy.
The slowest model produces the most accurate masks, while the masks from the medium model are slightly worse.
The masks from the <cite>Fast</cite> model are currently not recommended due to poor quality. Must be either “Slow”, “Medium” or
“Fast”. “Medium” is recommended.
Default: “Medium”</p>
</dd></dl>

<dl class="data">
<dt id="config.mask_dilation_pixels">
<code class="sig-prename descclassname">config.</code><code class="sig-name descname">mask_dilation_pixels</code><em class="property"> = 4</em><a class="headerlink" href="#config.mask_dilation_pixels" title="Permalink to this definition">¶</a></dt>
<dd><p>Approximate number of pixels for mask dilation. This will help ensure that an identified object is completely covered
by the corresponding mask. Set <cite>mask_dilation_pixels = 0</cite> to disable mask dilation.
Default: 4</p>
</dd></dl>

<dl class="data">
<dt id="config.max_image_height">
<code class="sig-prename descclassname">config.</code><code class="sig-name descname">max_image_height</code><em class="property"> = 1200</em><a class="headerlink" href="#config.max_image_height" title="Permalink to this definition">¶</a></dt>
<dd><p>Maximum height of images to be processed by the masking model. If the height of an image exceeds this value, it will
be resized before the masker is applied. This will NOT change the resolution of the output image.</p>
</dd></dl>

<dl class="data">
<dt id="config.mask_color">
<code class="sig-prename descclassname">config.</code><code class="sig-name descname">mask_color</code><em class="property"> = None</em><a class="headerlink" href="#config.mask_color" title="Permalink to this definition">¶</a></dt>
<dd><p>“RGB tuple [0-255] indicating the masking color. Setting this option will override the
colors specified below. Example: Setting <cite>mask_color = (50, 50, 50)</cite> will make all masks
dark gray.</p>
</dd></dl>

<dl class="data">
<dt id="config.blur">
<code class="sig-prename descclassname">config.</code><code class="sig-name descname">blur</code><em class="property"> = 15</em><a class="headerlink" href="#config.blur" title="Permalink to this definition">¶</a></dt>
<dd><p>Blurring coefficient [1-100] which specifies the degree of blurring to apply within the
mask. When this parameter is specified, the image will be blurred, and not masked with a
specific color. Set <cite>blur = None</cite> to disable blurring, and use colored masks instead.
Default: 15</p>
</dd></dl>

<dl class="data">
<dt id="config.gray_blur">
<code class="sig-prename descclassname">config.</code><code class="sig-name descname">gray_blur</code><em class="property"> = True</em><a class="headerlink" href="#config.gray_blur" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert the image to grayscale before blurring? (Ignored if blurring is disabled)
Default: True</p>
</dd></dl>

<dl class="data">
<dt id="config.normalized_gray_blur">
<code class="sig-prename descclassname">config.</code><code class="sig-name descname">normalized_gray_blur</code><em class="property"> = True</em><a class="headerlink" href="#config.normalized_gray_blur" title="Permalink to this definition">¶</a></dt>
<dd><p>Normalize the gray level within each mask after blurring? This will make bright colors indistinguishable from dark
colors. NOTE: Requires gray_blur=True
Default: True</p>
</dd></dl>

<dl class="data">
<dt id="config.write_exif_to_db">
<code class="sig-prename descclassname">config.</code><code class="sig-name descname">write_exif_to_db</code><em class="property"> = False</em><a class="headerlink" href="#config.write_exif_to_db" title="Permalink to this definition">¶</a></dt>
<dd><p>Write the EXIF data to the database?</p>
</dd></dl>

<dl class="data">
<dt id="config.db_max_n_accumulated_rows">
<code class="sig-prename descclassname">config.</code><code class="sig-name descname">db_max_n_accumulated_rows</code><em class="property"> = 8</em><a class="headerlink" href="#config.db_max_n_accumulated_rows" title="Permalink to this definition">¶</a></dt>
<dd><p>Maximum number of rows to accumulate locally before writing all accumulated rows to the database.</p>
</dd></dl>

<dl class="data">
<dt id="config.TF_DATASET_NUM_PARALLEL_CALLS">
<code class="sig-prename descclassname">config.</code><code class="sig-name descname">TF_DATASET_NUM_PARALLEL_CALLS</code><em class="property"> = 1</em><a class="headerlink" href="#config.TF_DATASET_NUM_PARALLEL_CALLS" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of parallel calls to tf.dataset.map and tf.dataset.prefetch. Set <cite>TF_DATASET_NUM_PARALLEL_CALLS = “auto”</cite> to
use tf.data.experimental.AUTOTUNE. This might yield a small gain in performance.</p>
</dd></dl>

<dl class="data">
<dt id="config.MODEL_NAME">
<code class="sig-prename descclassname">config.</code><code class="sig-name descname">MODEL_NAME</code><em class="property"> = 'mask_rcnn_resnet101_atrous_coco_2018_01_28'</em><a class="headerlink" href="#config.MODEL_NAME" title="Permalink to this definition">¶</a></dt>
<dd><p>Actual name of the masking model. Controlled by the value of <cite>model_type</cite></p>
</dd></dl>

<dl class="data">
<dt id="config.DOWNLOAD_BASE">
<code class="sig-prename descclassname">config.</code><code class="sig-name descname">DOWNLOAD_BASE</code><em class="property"> = 'http://download.tensorflow.org/models/object_detection/'</em><a class="headerlink" href="#config.DOWNLOAD_BASE" title="Permalink to this definition">¶</a></dt>
<dd><p>Base URL for model downloading</p>
</dd></dl>

<dl class="data">
<dt id="config.PATH_TO_LABELS">
<code class="sig-prename descclassname">config.</code><code class="sig-name descname">PATH_TO_LABELS</code><em class="property"> = 'mscoco_label_map.pbtxt'</em><a class="headerlink" href="#config.PATH_TO_LABELS" title="Permalink to this definition">¶</a></dt>
<dd><p>List of the strings that is used to add correct label for each box.</p>
</dd></dl>

<dl class="data">
<dt id="config.MASK_LABELS">
<code class="sig-prename descclassname">config.</code><code class="sig-name descname">MASK_LABELS</code><em class="property"> = (1, 2, 3, 4, 6, 8)</em><a class="headerlink" href="#config.MASK_LABELS" title="Permalink to this definition">¶</a></dt>
<dd><p>COCO labels to mask in input images</p>
</dd></dl>

<dl class="data">
<dt id="config.LABEL_COLORS">
<code class="sig-prename descclassname">config.</code><code class="sig-name descname">LABEL_COLORS</code><em class="property"> = {1: (255, 255, 255), 2: (0, 0, 255), 3: (255, 0, 0), 4: (255, 255, 0), 6: (0, 255, 255), 8: (0, 255, 0)}</em><a class="headerlink" href="#config.LABEL_COLORS" title="Permalink to this definition">¶</a></dt>
<dd><p>Masking colors. &lt;COCO label id&gt;: &lt;RGB color&gt;</p>
</dd></dl>

<dl class="data">
<dt id="config.DEFAULT_COLOR">
<code class="sig-prename descclassname">config.</code><code class="sig-name descname">DEFAULT_COLOR</code><em class="property"> = (100, 100, 100)</em><a class="headerlink" href="#config.DEFAULT_COLOR" title="Permalink to this definition">¶</a></dt>
<dd><p>Default color for labels not contained in <cite>LABEL_COLORS</cite></p>
</dd></dl>

<dl class="data">
<dt id="config.LABEL_MAP">
<code class="sig-prename descclassname">config.</code><code class="sig-name descname">LABEL_MAP</code><em class="property"> = {1: 'person', 2: 'bicycle', 3: 'car', 4: 'motorcycle', 5: 'airplane', 6: 'bus', 7: 'train', 8: 'truck', 9: 'boat', 10: 'traffic light', 11: 'fire hydrant', 13: 'stop sign', 14: 'parking meter', 15: 'bench', 16: 'bird', 17: 'cat', 18: 'dog', 19: 'horse', 20: 'sheep', 21: 'cow', 22: 'elephant', 23: 'bear', 24: 'zebra', 25: 'giraffe', 27: 'backpack', 28: 'umbrella', 31: 'handbag', 32: 'tie', 33: 'suitcase', 34: 'frisbee', 35: 'skis', 36: 'snowboard', 37: 'sports ball', 38: 'kite', 39: 'baseball bat', 40: 'baseball glove', 41: 'skateboard', 42: 'surfboard', 43: 'tennis racket', 44: 'bottle', 46: 'wine glass', 47: 'cup', 48: 'fork', 49: 'knife', 50: 'spoon', 51: 'bowl', 52: 'banana', 53: 'apple', 54: 'sandwich', 55: 'orange', 56: 'broccoli', 57: 'carrot', 58: 'hot dog', 59: 'pizza', 60: 'donut', 61: 'cake', 62: 'chair', 63: 'couch', 64: 'potted plant', 65: 'bed', 67: 'dining table', 70: 'toilet', 72: 'tv', 73: 'laptop', 74: 'mouse', 75: 'remote', 76: 'keyboard', 77: 'cell phone', 78: 'microwave', 79: 'oven', 80: 'toaster', 81: 'sink', 82: 'refrigerator', 84: 'book', 85: 'clock', 86: 'vase', 87: 'scissors', 88: 'teddy bear', 89: 'hair drier', 90: 'toothbrush'}</em><a class="headerlink" href="#config.LABEL_MAP" title="Permalink to this definition">¶</a></dt>
<dd><p>Label map for the COCO dataset.</p>
</dd></dl>

</div>
<div class="section" id="db">
<h2>db<a class="headerlink" href="#db" title="Permalink to this headline">¶</a></h2>
<div class="section" id="module-src.db.DatabaseClient">
<span id="db-databaseclient"></span><h3>db.DatabaseClient<a class="headerlink" href="#module-src.db.DatabaseClient" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="src.db.DatabaseClient.DatabaseClient">
<em class="property">class </em><code class="sig-prename descclassname">src.db.DatabaseClient.</code><code class="sig-name descname">DatabaseClient</code><span class="sig-paren">(</span><em class="sig-param">max_n_accumulated_rows=8</em><span class="sig-paren">)</span><a class="headerlink" href="#src.db.DatabaseClient.DatabaseClient" title="Permalink to this definition">¶</a></dt>
<dd><p>Class used to handle database writes. Connection parameters are specified in <cite>src.db.db_config</cite>. This class can also
be instantiated as a context manager.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>max_n_accumulated_rows</strong> (<em>int</em>) – Maximum number of rows to accumulate before actually writing them to the remote
database.</p>
</dd>
</dl>
<dl class="method">
<dt id="src.db.DatabaseClient.DatabaseClient.connect">
<em class="property">static </em><code class="sig-name descname">connect</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#src.db.DatabaseClient.DatabaseClient.connect" title="Permalink to this definition">¶</a></dt>
<dd><p>Connect to the database, and set the schema if it is specified.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>Database connection object</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>cxo.Connection</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="src.db.DatabaseClient.DatabaseClient.add_row">
<code class="sig-name descname">add_row</code><span class="sig-paren">(</span><em class="sig-param">json_dict</em><span class="sig-paren">)</span><a class="headerlink" href="#src.db.DatabaseClient.DatabaseClient.add_row" title="Permalink to this definition">¶</a></dt>
<dd><p>Add the contents of <cite>json_dict</cite> to the buffer, which will eventually be written to the remote database. When the
buffer size (number of accumulated rows) exceeds <cite>self.max_n_accumulated_rows</cite>, all the accumulated rows will be
written to the database. The buffer will then be cleared.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>json_dict</strong> (<em>dict</em>) – EXIF data</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="src.db.DatabaseClient.DatabaseClient.insert_accumulated_rows">
<code class="sig-name descname">insert_accumulated_rows</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#src.db.DatabaseClient.DatabaseClient.insert_accumulated_rows" title="Permalink to this definition">¶</a></dt>
<dd><p>Insert all accumulated rows into the database</p>
</dd></dl>

<dl class="method">
<dt id="src.db.DatabaseClient.DatabaseClient.close">
<code class="sig-name descname">close</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#src.db.DatabaseClient.DatabaseClient.close" title="Permalink to this definition">¶</a></dt>
<dd><p>Insert the remaining accumulated rows into the database</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-src.db.formatters">
<span id="db-formatters"></span><h3>db.formatters<a class="headerlink" href="#module-src.db.formatters" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="src.db.formatters.get_insert_sql">
<code class="sig-prename descclassname">src.db.formatters.</code><code class="sig-name descname">get_insert_sql</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#src.db.formatters.get_insert_sql" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the SQL expression used to insert a row into the database</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><cite>INSERT</cite> SQL expression</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>string</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="src.db.formatters.create_row">
<code class="sig-prename descclassname">src.db.formatters.</code><code class="sig-name descname">create_row</code><span class="sig-paren">(</span><em class="sig-param">json_dict</em><span class="sig-paren">)</span><a class="headerlink" href="#src.db.formatters.create_row" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a database row from the given <cite>json_dict</cite>. See <cite>src.db.setup_table</cite> for the list of columns.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>json_dict</strong> (<em>dict</em>) – EXIF data</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Dict representing the database row.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

</div>
</div>
<div class="section" id="io">
<h2>io<a class="headerlink" href="#io" title="Permalink to this headline">¶</a></h2>
<div class="section" id="module-src.io.exif_util">
<span id="io-exif-util"></span><h3>io.exif_util<a class="headerlink" href="#module-src.io.exif_util" title="Permalink to this headline">¶</a></h3>
<p>From: <a class="reference external" href="https://github.com/vegvesen/vegbilder/blob/master/trinn1_lagmetadata/vegbilder_lesexif.py">https://github.com/vegvesen/vegbilder/blob/master/trinn1_lagmetadata/vegbilder_lesexif.py</a></p>
<dl class="data">
<dt id="src.io.exif_util.VIATECH_TAGS">
<code class="sig-prename descclassname">src.io.exif_util.</code><code class="sig-name descname">VIATECH_TAGS</code><em class="property"> = {40055: 'ImageProperties', 40056: 'ReflinkInfo'}</em><a class="headerlink" href="#src.io.exif_util.VIATECH_TAGS" title="Permalink to this definition">¶</a></dt>
<dd><p>Tags from Viatech</p>
</dd></dl>

<dl class="data">
<dt id="src.io.exif_util.LOVLIG_VEGSTATUS">
<code class="sig-prename descclassname">src.io.exif_util.</code><code class="sig-name descname">LOVLIG_VEGSTATUS</code><em class="property"> = ['S', 'H', 'W', 'A', 'P', 'E', 'B', 'U', 'Q', 'V', 'X', 'M', 'T', 'G']</em><a class="headerlink" href="#src.io.exif_util.LOVLIG_VEGSTATUS" title="Permalink to this definition">¶</a></dt>
<dd><p>Lovlige vegstatuser</p>
</dd></dl>

<dl class="data">
<dt id="src.io.exif_util.LOVLIG_VEGKATEGORI">
<code class="sig-prename descclassname">src.io.exif_util.</code><code class="sig-name descname">LOVLIG_VEGKATEGORI</code><em class="property"> = ['E', 'R', 'F', 'K', 'P', 'S']</em><a class="headerlink" href="#src.io.exif_util.LOVLIG_VEGKATEGORI" title="Permalink to this definition">¶</a></dt>
<dd><p>Lovlige vegkategorier</p>
</dd></dl>

<dl class="data">
<dt id="src.io.exif_util.REDACT_XML_TAGS">
<code class="sig-prename descclassname">src.io.exif_util.</code><code class="sig-name descname">REDACT_XML_TAGS</code><em class="property"> = ['Driver', 'CarID', 'Comment']</em><a class="headerlink" href="#src.io.exif_util.REDACT_XML_TAGS" title="Permalink to this definition">¶</a></dt>
<dd><p>XML tags which should be redacted in the <cite>ImageProperties</cite> XML.</p>
</dd></dl>

<dl class="data">
<dt id="src.io.exif_util.REDACT_XML_REGEX_PATTERNS">
<code class="sig-prename descclassname">src.io.exif_util.</code><code class="sig-name descname">REDACT_XML_REGEX_PATTERNS</code><em class="property"> = [re.compile('&lt;Driver&gt;.*&lt;/Driver'), re.compile('&lt;CarID&gt;.*&lt;/CarID'), re.compile('&lt;Comment&gt;.*&lt;/Comment')]</em><a class="headerlink" href="#src.io.exif_util.REDACT_XML_REGEX_PATTERNS" title="Permalink to this definition">¶</a></dt>
<dd><p>Regex patterns to use when redacting the <cite>ImageProperties</cite> XML. Precompiled for speed.</p>
</dd></dl>

<dl class="data">
<dt id="src.io.exif_util.REDACT_XML_REPLACE_STRINGS">
<code class="sig-prename descclassname">src.io.exif_util.</code><code class="sig-name descname">REDACT_XML_REPLACE_STRINGS</code><em class="property"> = ['&lt;Driver&gt;FJERNET&lt;/Driver', '&lt;CarID&gt;FJERNET&lt;/CarID', '&lt;Comment&gt;FJERNET&lt;/Comment']</em><a class="headerlink" href="#src.io.exif_util.REDACT_XML_REPLACE_STRINGS" title="Permalink to this definition">¶</a></dt>
<dd><p>Placeholders for the redacted entries</p>
</dd></dl>

<dl class="function">
<dt id="src.io.exif_util.exif_from_file">
<code class="sig-prename descclassname">src.io.exif_util.</code><code class="sig-name descname">exif_from_file</code><span class="sig-paren">(</span><em class="sig-param">image_path</em><span class="sig-paren">)</span><a class="headerlink" href="#src.io.exif_util.exif_from_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Retrieve the EXIF-data from the image located at <cite>image_path</cite></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>image_path</strong> (<em>str</em>) – Path to input image</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>EXIF data</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="src.io.exif_util.get_exif">
<code class="sig-prename descclassname">src.io.exif_util.</code><code class="sig-name descname">get_exif</code><span class="sig-paren">(</span><em class="sig-param">img</em><span class="sig-paren">)</span><a class="headerlink" href="#src.io.exif_util.get_exif" title="Permalink to this definition">¶</a></dt>
<dd><p>Parse the EXIF data from <cite>img</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>img</strong> (<em>PIL.Image</em>) – Input image</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>EXIF data</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="src.io.exif_util.label_exif">
<code class="sig-prename descclassname">src.io.exif_util.</code><code class="sig-name descname">label_exif</code><span class="sig-paren">(</span><em class="sig-param">exif</em><span class="sig-paren">)</span><a class="headerlink" href="#src.io.exif_util.label_exif" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert the standard integer EXIF-keys in <cite>exif</cite> to text keys.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>exif</strong> (<em>dict</em>) – EXIF dict from <cite>PIL.Image._getexif</cite>.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>EXIF dict with text keys.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="src.io.exif_util.process_image_properties">
<code class="sig-prename descclassname">src.io.exif_util.</code><code class="sig-name descname">process_image_properties</code><span class="sig-paren">(</span><em class="sig-param">contents</em><span class="sig-paren">)</span><a class="headerlink" href="#src.io.exif_util.process_image_properties" title="Permalink to this definition">¶</a></dt>
<dd><p>Process the <cite>ImageProperties</cite> XML from the EXIF header</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>contents</strong> (<em>bytes</em>) – XML-contents</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Relevant information extracted from <cite>contents</cite></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="src.io.exif_util.to_pretty_xml">
<code class="sig-prename descclassname">src.io.exif_util.</code><code class="sig-name descname">to_pretty_xml</code><span class="sig-paren">(</span><em class="sig-param">contents_bytes</em><span class="sig-paren">)</span><a class="headerlink" href="#src.io.exif_util.to_pretty_xml" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert bytes-encoded XML to a prettified string.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>contents_bytes</strong> (<em>bytes</em>) – Bytes-encoded XML contents</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Prettified contents</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="src.io.exif_util.redact_image_properties">
<code class="sig-prename descclassname">src.io.exif_util.</code><code class="sig-name descname">redact_image_properties</code><span class="sig-paren">(</span><em class="sig-param">contents</em><span class="sig-paren">)</span><a class="headerlink" href="#src.io.exif_util.redact_image_properties" title="Permalink to this definition">¶</a></dt>
<dd><p>Redact entries in <cite>contents</cite>. See <cite>REDACT_XML_TAGS</cite> for the list of tags to be redacted.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>contents</strong> (<em>str</em>) – XML containing tags to be redacted.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Redacted contents</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="src.io.exif_util.process_reflink_info">
<code class="sig-prename descclassname">src.io.exif_util.</code><code class="sig-name descname">process_reflink_info</code><span class="sig-paren">(</span><em class="sig-param">contents</em><span class="sig-paren">)</span><a class="headerlink" href="#src.io.exif_util.process_reflink_info" title="Permalink to this definition">¶</a></dt>
<dd><p>Process the <cite>ReflinkInfo</cite> XML from the EXIF header.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>contents</strong> (<em>bytes | None</em>) – XML-contents. If <cite>contents</cite> is <cite>None</cite>, a dict with the required keys and None values, will be
returned.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Relevant information extracted from <cite>contents</cite></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-src.io.load">
<span id="io-load"></span><h3>io.load<a class="headerlink" href="#module-src.io.load" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="src.io.load.load_image">
<code class="sig-prename descclassname">src.io.load.</code><code class="sig-name descname">load_image</code><span class="sig-paren">(</span><em class="sig-param">image_path</em>, <em class="sig-param">read_exif=True</em><span class="sig-paren">)</span><a class="headerlink" href="#src.io.load.load_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads the image at ‘image_path’ and returns it as an array. None is returned i the image could not be loaded.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image_path</strong> (<em>str</em>) – Path to image. Must end with ‘.jpg’</p></li>
<li><p><strong>read_exif</strong> (<em>bool</em>) – Read the EXIF data from the input image?</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Image array</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>(np.ndarray, dict | None) | None</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="src.io.load.check_input_img">
<code class="sig-prename descclassname">src.io.load.</code><code class="sig-name descname">check_input_img</code><span class="sig-paren">(</span><em class="sig-param">img</em><span class="sig-paren">)</span><a class="headerlink" href="#src.io.load.check_input_img" title="Permalink to this definition">¶</a></dt>
<dd><p>Check that the given image (represented as a numpy array) is valid for masking.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>img</strong> (<em>np.ndarray</em>) – Input image</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-src.io.save">
<span id="io-save"></span><h3>io.save<a class="headerlink" href="#module-src.io.save" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="src.io.save.save_processed_img">
<code class="sig-prename descclassname">src.io.save.</code><code class="sig-name descname">save_processed_img</code><span class="sig-paren">(</span><em class="sig-param">img</em>, <em class="sig-param">mask_results</em>, <em class="sig-param">paths</em>, <em class="sig-param">draw_mask=False</em>, <em class="sig-param">local_mask=False</em>, <em class="sig-param">remote_mask=False</em>, <em class="sig-param">mask_color=None</em>, <em class="sig-param">blur=None</em>, <em class="sig-param">gray_blur=True</em>, <em class="sig-param">normalized_gray_blur=True</em><span class="sig-paren">)</span><a class="headerlink" href="#src.io.save.save_processed_img" title="Permalink to this definition">¶</a></dt>
<dd><p>Save an image which has been processed by the masker.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>img</strong> (<em>np.ndarray</em>) – Input image</p></li>
<li><p><strong>mask_results</strong> (<em>dict</em>) – Dictionary containing masking results. Format must be as returned by Masker.mask.</p></li>
<li><p><strong>paths</strong> (<a class="reference internal" href="#src.io.TreeWalker.Paths" title="src.io.TreeWalker.Paths"><em>src.io.TreeWalker.Paths</em></a>) – Paths object representing the image file.</p></li>
<li><p><strong>draw_mask</strong> (<em>bool</em>) – Draw the mask on the image?</p></li>
<li><p><strong>local_mask</strong> (<em>bool</em>) – Write the Mask file to the input directory?</p></li>
<li><p><strong>remote_mask</strong> (<em>bool</em>) – Write the Mask file to the output directory?</p></li>
<li><p><strong>mask_color</strong> (<em>list | None</em>) – Mask color. All masks in the output image will have this color. If <cite>mask_color</cite> is None, the
colors in <cite>config</cite> will be used.</p></li>
<li><p><strong>blur</strong> (<em>int | float | None</em>) – When <cite>blur</cite> is not None, the image will be blurred instead of colored at the masked locations. <cite>blur</cite>
should be a number in [1 - 1000] indicating the size of the mask used in for blurring. Specifically,
<cite>mask_size = (blur / 1000) * image_width</cite>.</p></li>
<li><p><strong>gray_blur</strong> (<em>bool</em>) – Convert the image to grayscale before blurring?</p></li>
<li><p><strong>normalized_gray_blur</strong> (<em>bool</em>) – Normalize the gray level within each mask after blurring? This will make bright colors
indistinguishable from dark colors. NOTE: Requires gray_blur=True.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>0</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="src.io.save.archive">
<code class="sig-prename descclassname">src.io.save.</code><code class="sig-name descname">archive</code><span class="sig-paren">(</span><em class="sig-param">paths</em>, <em class="sig-param">archive_mask=False</em>, <em class="sig-param">archive_json=False</em>, <em class="sig-param">delete_input_img=False</em>, <em class="sig-param">assert_output_mask=True</em><span class="sig-paren">)</span><a class="headerlink" href="#src.io.save.archive" title="Permalink to this definition">¶</a></dt>
<dd><p>Copy the input image file (and possibly some output files) to the archive directory.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>paths</strong> (<a class="reference internal" href="#src.io.TreeWalker.Paths" title="src.io.TreeWalker.Paths"><em>src.io.TreeWalker.Paths</em></a>) – Paths object representing the image file.</p></li>
<li><p><strong>archive_mask</strong> (<em>bool</em>) – Copy the mask file to the archive directory?</p></li>
<li><p><strong>archive_json</strong> (<em>bool</em>) – Copy the EXIF file to the archive directory?</p></li>
<li><p><strong>delete_input_img</strong> (<em>bool</em>) – Delete the image from the input directory?</p></li>
<li><p><strong>assert_output_mask</strong> (<em>bool</em>) – Assert that the output mask exists before archiving?</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>0</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-src.io.tf_dataset">
<span id="io-tf-dataset"></span><h3>io.tf_dataset<a class="headerlink" href="#module-src.io.tf_dataset" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="src.io.tf_dataset.prepare_img">
<code class="sig-prename descclassname">src.io.tf_dataset.</code><code class="sig-name descname">prepare_img</code><span class="sig-paren">(</span><em class="sig-param">input_file</em><span class="sig-paren">)</span><a class="headerlink" href="#src.io.tf_dataset.prepare_img" title="Permalink to this definition">¶</a></dt>
<dd><p>Load the image named <cite>filename</cite> from <cite>input_dir</cite>, and check that is is valid.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>input_file</strong> (<em>tf.string</em>) – Path to input image</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Loaded image</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>tf.python.framework.ops.EagerTensor</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="src.io.tf_dataset.get_tf_dataset">
<code class="sig-prename descclassname">src.io.tf_dataset.</code><code class="sig-name descname">get_tf_dataset</code><span class="sig-paren">(</span><em class="sig-param">tree_walker</em><span class="sig-paren">)</span><a class="headerlink" href="#src.io.tf_dataset.get_tf_dataset" title="Permalink to this definition">¶</a></dt>
<dd><p>Create an TensorFlow dataset using the given instance of <cite>TreeWalker</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>tree_walker</strong> (<a class="reference internal" href="#src.io.TreeWalker.TreeWalker" title="src.io.TreeWalker.TreeWalker"><em>src.io.TreeWalker.TreeWalker</em></a>) – TreeWalker to use to locate images.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A dataset that yields properly formatted and valid image tensors.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>tf.data.Dataset</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-src.io.TreeWalker">
<span id="io-treewalker"></span><h3>io.TreeWalker<a class="headerlink" href="#module-src.io.TreeWalker" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="src.io.TreeWalker.Paths">
<em class="property">class </em><code class="sig-prename descclassname">src.io.TreeWalker.</code><code class="sig-name descname">Paths</code><span class="sig-paren">(</span><em class="sig-param">base_input_dir</em>, <em class="sig-param">base_mirror_dirs</em>, <em class="sig-param">input_dir</em>, <em class="sig-param">mirror_dirs</em>, <em class="sig-param">filename</em><span class="sig-paren">)</span><a class="headerlink" href="#src.io.TreeWalker.Paths" title="Permalink to this definition">¶</a></dt>
<dd><p>Object which holds the path-information about an image. <cite>src.io.TreeWalker.TreeWalker.walk</cite> returns instances of
this class. Input directories and mirror directories and files are all available through dot-syntax.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>base_input_dir</strong> (<em>str</em>) – Base directory for input files.</p></li>
<li><p><strong>base_mirror_dirs</strong> (<em>list of str</em>) – Base directories for mirror files. The first element is assumed to be the output directory.
The second element is assumed to be the archive directory.</p></li>
<li><p><strong>input_dir</strong> (<em>str</em>) – Directory containing the file represented by the object.</p></li>
<li><p><strong>mirror_dirs</strong> (<em>list of str</em>) – Mirror directories for the file represented by the object.</p></li>
<li><p><strong>filename</strong> (<em>str</em>) – Name of file represented by the object</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="class">
<dt id="src.io.TreeWalker.TreeWalker">
<em class="property">class </em><code class="sig-prename descclassname">src.io.TreeWalker.</code><code class="sig-name descname">TreeWalker</code><span class="sig-paren">(</span><em class="sig-param">input_folder</em>, <em class="sig-param">mirror_folders</em>, <em class="sig-param">skip_webp=True</em>, <em class="sig-param">precompute_paths=True</em>, <em class="sig-param">ext='jpg'</em><span class="sig-paren">)</span><a class="headerlink" href="#src.io.TreeWalker.TreeWalker" title="Permalink to this definition">¶</a></dt>
<dd><p>Traverses a file-tree and finds all valid files with extension <cite>ext</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_folder</strong> (<em>str</em>) – Root directory for tree traversal.</p></li>
<li><p><strong>mirror_folders</strong> (<em>list of str</em>) – List of directories to traverse in parallel to <cite>input_folders</cite>.</p></li>
<li><p><strong>skip_webp</strong> (<em>bool</em>) – Skip images that already have an associated .webp file in <cite>output_folder</cite>.</p></li>
<li><p><strong>precompute_paths</strong> (<em>bool</em>) – Traverse the whole tree during initialization? When this is true, <cite>TreeWalker.walk</cite>
will return an iterator. Otherwise it will return a generator.</p></li>
<li><p><strong>ext</strong> (<em>str</em>) – File extension for files returned by <cite>TreeWalker.walk</cite>.</p></li>
</ul>
</dd>
</dl>
<dl class="method">
<dt id="src.io.TreeWalker.TreeWalker.walk">
<code class="sig-name descname">walk</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#src.io.TreeWalker.TreeWalker.walk" title="Permalink to this definition">¶</a></dt>
<dd><p>Traverse the file tree in <cite>input_folder</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><p>If <cite>precompute_paths</cite> is True, this will simply return an iterator where each element is an instance of
<cite>src.io.TreeWalker.Paths</cite>.</p>
<p>Otherwise, it will call a generator returning the objects described above.</p>
</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>iterator | tuple of str</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-src.io.file_access_guard">
<span id="io-file-access-guard"></span><h3>io.file_access_guard<a class="headerlink" href="#module-src.io.file_access_guard" title="Permalink to this headline">¶</a></h3>
<dl class="exception">
<dt id="src.io.file_access_guard.PathNotReachableError">
<em class="property">exception </em><code class="sig-prename descclassname">src.io.file_access_guard.</code><code class="sig-name descname">PathNotReachableError</code><a class="headerlink" href="#src.io.file_access_guard.PathNotReachableError" title="Permalink to this definition">¶</a></dt>
<dd><p>Error raised when one or more paths cannot be reached</p>
</dd></dl>

<dl class="function">
<dt id="src.io.file_access_guard.all_exists">
<code class="sig-prename descclassname">src.io.file_access_guard.</code><code class="sig-name descname">all_exists</code><span class="sig-paren">(</span><em class="sig-param">paths</em>, <em class="sig-param">exists_func=&lt;function exists&gt;</em><span class="sig-paren">)</span><a class="headerlink" href="#src.io.file_access_guard.all_exists" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns true if all elements of <cite>paths</cite> is a valid path.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>paths</strong> (<em>list of str | tuple of str | np.ndarray</em>) – Iterable where each element is a string of paths. The elements can also be <cite>bytes</cite>.</p></li>
<li><p><strong>exists_func</strong> (<em>function</em>) – Function which checks if the path exists. Default is <cite>os.path.exists</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>True if all paths exists, False otherwise</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="src.io.file_access_guard.wait_until_path_is_found">
<code class="sig-prename descclassname">src.io.file_access_guard.</code><code class="sig-name descname">wait_until_path_is_found</code><span class="sig-paren">(</span><em class="sig-param">paths</em>, <em class="sig-param">retry_interval=10</em>, <em class="sig-param">timeout=60</em><span class="sig-paren">)</span><a class="headerlink" href="#src.io.file_access_guard.wait_until_path_is_found" title="Permalink to this definition">¶</a></dt>
<dd><p>Blocks execution until all elements of <cite>paths</cite> are valid paths, for <cite>timeout</cite> seconds. If the timeout is reached,
and one or more paths still do not exist, a <cite>PathNotReachableError</cite> will be raised.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>paths</strong> (<em>list of str | tuple of str | np.ndarray</em>) – Iterable where each element is a string of paths. The elements can also be <cite>bytes</cite>.</p></li>
<li><p><strong>retry_interval</strong> (<em>int</em>) – Number of seconds to wait between each retry.</p></li>
<li><p><strong>timeout</strong> (<em>int</em>) – Total number of seconds to wait.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>0, if the existence of all paths is confirmed before the timeout is reached.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-src.io.file_checker">
<span id="io-file-checker"></span><h3>io.file_checker<a class="headerlink" href="#module-src.io.file_checker" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="src.io.file_checker.check_all_files_written">
<code class="sig-prename descclassname">src.io.file_checker.</code><code class="sig-name descname">check_all_files_written</code><span class="sig-paren">(</span><em class="sig-param">paths</em><span class="sig-paren">)</span><a class="headerlink" href="#src.io.file_checker.check_all_files_written" title="Permalink to this definition">¶</a></dt>
<dd><p>Check that all files for a given image have been saved correctly. The list of checked files is determined by the
File I/O parameters in <cite>config</cite>. If all expected output files exist, the cache file will be deleted. If all expected
output files exist, AND <cite>config.delete_input</cite> is True, the input image will be deleted as well.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>paths</strong> (<a class="reference internal" href="#src.io.TreeWalker.Paths" title="src.io.TreeWalker.Paths"><em>src.io.TreeWalker.Paths</em></a>) – Paths object representing the input image</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>True if all expected files were found. False otherwise</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="src.io.file_checker.find_missing_files">
<code class="sig-prename descclassname">src.io.file_checker.</code><code class="sig-name descname">find_missing_files</code><span class="sig-paren">(</span><em class="sig-param">paths</em><span class="sig-paren">)</span><a class="headerlink" href="#src.io.file_checker.find_missing_files" title="Permalink to this definition">¶</a></dt>
<dd><p>Find any missing files among the expected output files for the given image.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>paths</strong> (<a class="reference internal" href="#src.io.TreeWalker.Paths" title="src.io.TreeWalker.Paths"><em>src.io.TreeWalker.Paths</em></a>) – Paths object representing the input image</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>List of missing output files</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>list of str</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="src.io.file_checker.get_expected_files">
<code class="sig-prename descclassname">src.io.file_checker.</code><code class="sig-name descname">get_expected_files</code><span class="sig-paren">(</span><em class="sig-param">paths</em><span class="sig-paren">)</span><a class="headerlink" href="#src.io.file_checker.get_expected_files" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a list of the output files we expect to find for the given image.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>paths</strong> (<a class="reference internal" href="#src.io.TreeWalker.Paths" title="src.io.TreeWalker.Paths"><em>src.io.TreeWalker.Paths</em></a>) – Paths object representing the input image</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>List of expected input files</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>list of str</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="src.io.file_checker.clear_cache">
<code class="sig-prename descclassname">src.io.file_checker.</code><code class="sig-name descname">clear_cache</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#src.io.file_checker.clear_cache" title="Permalink to this definition">¶</a></dt>
<dd><p>Clear the cache directory. Each JSON file in the cache directory is expected to represent an image for which the
export process was aborted due to a critical error. This function will clear the output files written for the
unfinished image, and then delete the cache file.</p>
</dd></dl>

<dl class="function">
<dt id="src.io.file_checker.clear_cache_file">
<code class="sig-prename descclassname">src.io.file_checker.</code><code class="sig-name descname">clear_cache_file</code><span class="sig-paren">(</span><em class="sig-param">file_path</em><span class="sig-paren">)</span><a class="headerlink" href="#src.io.file_checker.clear_cache_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Clear the output files for the unfinished image whose cahce file is located at <cite>file_path</cite></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>file_path</strong> (<em>str</em>) – Path to cache file for unfinished image</p>
</dd>
</dl>
</dd></dl>

</div>
</div>
<div class="section" id="module-src.email_sender">
<span id="email-sender"></span><h2>email_sender<a class="headerlink" href="#module-src.email_sender" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="src.email_sender.email_excepthook">
<code class="sig-prename descclassname">src.email_sender.</code><code class="sig-name descname">email_excepthook</code><span class="sig-paren">(</span><em class="sig-param">etype</em>, <em class="sig-param">ex</em>, <em class="sig-param">tb</em><span class="sig-paren">)</span><a class="headerlink" href="#src.email_sender.email_excepthook" title="Permalink to this definition">¶</a></dt>
<dd><p>Function which can be replaced with sys.excepthook in order to send an email when the program exits due to an
uncaught exception.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>etype</strong> – Exception type</p></li>
<li><p><strong>ex</strong> (<em>BaseException</em>) – Exception instance</p></li>
<li><p><strong>tb</strong> (<em>traceback.traceback</em>) – Traceback object representing the exception’s traceback</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="src.email_sender.send_mail">
<code class="sig-prename descclassname">src.email_sender.</code><code class="sig-name descname">send_mail</code><span class="sig-paren">(</span><em class="sig-param">message_type</em>, <em class="sig-param">etype=None</em>, <em class="sig-param">ex=None</em>, <em class="sig-param">tb=None</em>, <em class="sig-param">msg=None</em><span class="sig-paren">)</span><a class="headerlink" href="#src.email_sender.send_mail" title="Permalink to this definition">¶</a></dt>
<dd><p>Send an email of type <cite>message_type</cite>. The sender, receiver(s) and smtp-server are configured in <cite>email_config.py</cite>.
If  <cite>–log-folder</cite> is specified to <cite>src.main</cite>, the log-file will be attached to the message.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>message_type</strong> (<em>str</em>) – <p>Type of message. This determines the subject and contents of the message. Must be one of</p>
<ul>
<li><dl class="simple">
<dt><cite>critical</cite>: This is suitable for critical errors which cause the program to exit abnormally.</dt><dd><p>A critical message requires <cite>etype</cite>, <cite>ex</cite> and <cite>tb</cite> to be specified, and will
include the exception type in the subject, and the traceback in the contents.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><cite>error</cite>: This message is suitable for processing errors which do not cause the program to</dt><dd><p>exit.</p>
</dd>
</dl>
</li>
<li><p><cite>finished</cite>: This message type should be used when the program exits normally.</p></li>
</ul>
</p></li>
<li><p><strong>etype</strong> (<em>type | None</em>) – Exception type</p></li>
<li><p><strong>ex</strong> (<em>BaseException | None</em>) – Exception instance</p></li>
<li><p><strong>tb</strong> (<em>traceback.traceback | None</em>) – Traceback object</p></li>
<li><p><strong>msg</strong> (<em>str | None</em>) – Message to include in the contents of the email.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="src.email_sender.create_base_message">
<code class="sig-prename descclassname">src.email_sender.</code><code class="sig-name descname">create_base_message</code><span class="sig-paren">(</span><em class="sig-param">subject</em>, <em class="sig-param">msg=None</em><span class="sig-paren">)</span><a class="headerlink" href="#src.email_sender.create_base_message" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a base-message which is common for all message-types</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>subject</strong> (<em>str</em>) – Message subject</p></li>
<li><p><strong>msg</strong> (<em>str | None</em>) – Optional message to include in the contents.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Properly formatted email message converted to a string.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-src.ImageProcessor">
<span id="imageprocessor"></span><h2>ImageProcessor<a class="headerlink" href="#module-src.ImageProcessor" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="src.ImageProcessor.ImageProcessor">
<em class="property">class </em><code class="sig-prename descclassname">src.ImageProcessor.</code><code class="sig-name descname">ImageProcessor</code><span class="sig-paren">(</span><em class="sig-param">masker</em>, <em class="sig-param">max_num_async_workers=2</em><span class="sig-paren">)</span><a class="headerlink" href="#src.ImageProcessor.ImageProcessor" title="Permalink to this definition">¶</a></dt>
<dd><p>Implements the image processing pipeline. When an image is received, it will be masked, and the resulting output
files will be written asynchronously.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>masker</strong> (<a class="reference internal" href="#src.Masker.Masker" title="src.Masker.Masker"><em>src.Masker.Masker</em></a>) – Masker instance. Used to compute the image masks.</p></li>
<li><p><strong>max_num_async_workers</strong> (<em>int</em>) – Maximum number of async workers. When the number of dispatched workers exceeds
<cite>max_num_async_workers</cite>, <cite>ImageProcessor.process_image</cite> will stop and wait for all
dispatched workers to finish.</p></li>
</ul>
</dd>
</dl>
<dl class="method">
<dt id="src.ImageProcessor.ImageProcessor.process_image">
<code class="sig-name descname">process_image</code><span class="sig-paren">(</span><em class="sig-param">image</em>, <em class="sig-param">paths</em><span class="sig-paren">)</span><a class="headerlink" href="#src.ImageProcessor.ImageProcessor.process_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Run the processing pipeline for <cite>image</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image</strong> (<em>tf.python.framework.ops.EagerTensor</em>) – Input image. Must be a 4D color image tensor with shape (1, height, width, 3)</p></li>
<li><p><strong>paths</strong> (<a class="reference internal" href="#src.io.TreeWalker.Paths" title="src.io.TreeWalker.Paths"><em>src.io.TreeWalker.Paths</em></a>) – Paths object representing the image file.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="src.ImageProcessor.ImageProcessor.close">
<code class="sig-name descname">close</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#src.ImageProcessor.ImageProcessor.close" title="Permalink to this definition">¶</a></dt>
<dd><p>Close the image processing instance. Waits for all dispatched workers to finish, and then closes the
multiprocessing pool.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-src.main">
<span id="main"></span><h2>main<a class="headerlink" href="#module-src.main" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="src.main.get_args">
<code class="sig-prename descclassname">src.main.</code><code class="sig-name descname">get_args</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#src.main.get_args" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the command-line arguments.</p>
</dd></dl>

<dl class="function">
<dt id="src.main.check_config">
<code class="sig-prename descclassname">src.main.</code><code class="sig-name descname">check_config</code><span class="sig-paren">(</span><em class="sig-param">args</em><span class="sig-paren">)</span><a class="headerlink" href="#src.main.check_config" title="Permalink to this definition">¶</a></dt>
<dd><p>Check that the specified configuration variables are valid.</p>
</dd></dl>

<dl class="function">
<dt id="src.main.initialize">
<code class="sig-prename descclassname">src.main.</code><code class="sig-name descname">initialize</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#src.main.initialize" title="Permalink to this definition">¶</a></dt>
<dd><p>Get command line arguments, and initialize the TreeWalker and Masker.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>Command line arguments, an instance of <cite>TreeWalker</cite> initialized at the specified directories, and an
instance of <cite>Masker</cite> ready for masking.</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>argparse.Namespace, <a class="reference internal" href="#src.io.TreeWalker.TreeWalker" title="src.io.TreeWalker.TreeWalker">TreeWalker</a>, <a class="reference internal" href="#src.Masker.Masker" title="src.Masker.Masker">Masker</a></p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="src.main.get_estimated_done">
<code class="sig-prename descclassname">src.main.</code><code class="sig-name descname">get_estimated_done</code><span class="sig-paren">(</span><em class="sig-param">time_at_iter_start</em>, <em class="sig-param">n_imgs</em>, <em class="sig-param">n_masked</em><span class="sig-paren">)</span><a class="headerlink" href="#src.main.get_estimated_done" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the estimated completion time for the program.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>time_at_iter_start</strong> (<em>float</em>) – Time of iteration start</p></li>
<li><p><strong>n_imgs</strong> (<em>int | float | str</em>) – Number of total images to process. If this is not an int or a float, a “?” will be returned.</p></li>
<li><p><strong>n_masked</strong> (<em>int</em>) – Number of completed images</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>String-formatted estimated time of completion</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="src.main.get_summary">
<code class="sig-prename descclassname">src.main.</code><code class="sig-name descname">get_summary</code><span class="sig-paren">(</span><em class="sig-param">tree_walker</em>, <em class="sig-param">n_masked</em>, <em class="sig-param">start_datetime</em><span class="sig-paren">)</span><a class="headerlink" href="#src.main.get_summary" title="Permalink to this definition">¶</a></dt>
<dd><p>Log a summary of the masking process.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tree_walker</strong> (<a class="reference internal" href="#src.io.TreeWalker.TreeWalker" title="src.io.TreeWalker.TreeWalker"><em>TreeWalker</em></a>) – <cite>TreeWalker</cite> instance used in masking.</p></li>
<li><p><strong>n_masked</strong> (<em>int</em>) – Number of masked images</p></li>
<li><p><strong>start_datetime</strong> (<em>datetime.datetime</em>) – Datetime object indicating when the program started.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="src.main.main">
<code class="sig-prename descclassname">src.main.</code><code class="sig-name descname">main</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#src.main.main" title="Permalink to this definition">¶</a></dt>
<dd><p>Run the masking.</p>
</dd></dl>

</div>
<div class="section" id="module-src.Masker">
<span id="masker"></span><h2>Masker<a class="headerlink" href="#module-src.Masker" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="src.Masker.Masker">
<em class="property">class </em><code class="sig-prename descclassname">src.Masker.</code><code class="sig-name descname">Masker</code><span class="sig-paren">(</span><em class="sig-param">mask_dilation_pixels=0</em>, <em class="sig-param">max_image_height=10000</em><span class="sig-paren">)</span><a class="headerlink" href="#src.Masker.Masker" title="Permalink to this definition">¶</a></dt>
<dd><p>Implements the masking functionality. Uses a pre-trained TensorFlow model to compute masks for images. Model
configuration is done in <cite>config</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mask_dilation_pixels</strong> (<em>int</em>) – Approximate number of pixels for mask dilation. This will help ensure that an
identified object is completely covered by the corresponding mask. Set
<cite>mask_dilation_pixels = 0</cite> to disable mask dilation.</p></li>
<li><p><strong>max_image_height</strong> (<em>int</em>) – Maximum height of images to be processed by the masking model. If the height of an image
exceeds this value, it will be resized before the masker is applied. This will NOT change
the resolution of the output image.</p></li>
</ul>
</dd>
</dl>
<dl class="method">
<dt id="src.Masker.Masker.mask">
<code class="sig-name descname">mask</code><span class="sig-paren">(</span><em class="sig-param">image</em><span class="sig-paren">)</span><a class="headerlink" href="#src.Masker.Masker.mask" title="Permalink to this definition">¶</a></dt>
<dd><p>Run the masking on <cite>image</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>image</strong> (<em>tf.python.framework.ops.EagerTensor</em>) – Input image. Must be a 4D color image tensor with shape (1, height, width, 3)</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Dictionary containing masking results. Content depends on the model used.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="src.Masker.tensor_dict_to_numpy">
<code class="sig-prename descclassname">src.Masker.</code><code class="sig-name descname">tensor_dict_to_numpy</code><span class="sig-paren">(</span><em class="sig-param">input_dict</em>, <em class="sig-param">ignore_keys=()</em><span class="sig-paren">)</span><a class="headerlink" href="#src.Masker.tensor_dict_to_numpy" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert all values of type <cite>tf.Tensor</cite> in a dictionary to <cite>np.ndarray</cite> by calling the <cite>.numpy()</cite> method.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_dict</strong> (<em>dict</em>) – Dictionary containing tensors to convert.</p></li>
<li><p><strong>ignore_keys</strong> (<em>tuple | list</em>) – Optional iterable with keys to ignore</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Converted dictionary containing original keys and converted tensors. Keys in <cite>ignore_keys</cite> will not be
included.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="src.Masker.download_model">
<code class="sig-prename descclassname">src.Masker.</code><code class="sig-name descname">download_model</code><span class="sig-paren">(</span><em class="sig-param">download_base</em>, <em class="sig-param">model_name</em>, <em class="sig-param">model_path</em>, <em class="sig-param">extract_all=False</em><span class="sig-paren">)</span><a class="headerlink" href="#src.Masker.download_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Download a pre-trained model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>download_base</strong> (<em>str</em>) – Base URL for downloading</p></li>
<li><p><strong>model_name</strong> (<em>str</em>) – Name of model-file (without the .tar.gz extension)</p></li>
<li><p><strong>model_path</strong> (<em>str</em>) – Directory where the downloaded model shoud be stored.</p></li>
<li><p><strong>extract_all</strong> (<em>bool</em>) – When True, all files in the .tar.gz archive will be extracted. Otherwise, just extract
“frozen_inference_graph.pb”</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="src.Masker.reframe_box_masks_to_image_masks">
<code class="sig-prename descclassname">src.Masker.</code><code class="sig-name descname">reframe_box_masks_to_image_masks</code><span class="sig-paren">(</span><em class="sig-param">box_masks</em>, <em class="sig-param">boxes</em>, <em class="sig-param">image_height</em>, <em class="sig-param">image_width</em><span class="sig-paren">)</span><a class="headerlink" href="#src.Masker.reframe_box_masks_to_image_masks" title="Permalink to this definition">¶</a></dt>
<dd><p>From: <a class="reference external" href="https://github.com/tensorflow/models/blob/master/research/object_detection/utils/ops.py">https://github.com/tensorflow/models/blob/master/research/object_detection/utils/ops.py</a></p>
<p>Transforms the box masks back to full image masks.
Embeds masks in bounding boxes of larger masks whose shapes correspond to
image shape.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>box_masks</strong> (<em>tf.python.framework.ops.EagerTensor</em>) – A tf.float32 tensor of size [num_masks, mask_height, mask_width].</p></li>
<li><p><strong>boxes</strong> (<em>tf.python.framework.ops.EagerTensor</em>) – A tf.float32 tensor of size [num_masks, 4] containing the box
corners. Row i contains [ymin, xmin, ymax, xmax] of the box
corresponding to mask i. Note that the box corners are in
normalized coordinates.</p></li>
<li><p><strong>image_height</strong> (<em>int</em>) – Image height. The output mask will have the same height as
the image height.</p></li>
<li><p><strong>image_width</strong> (<em>int</em>) – Image width. The output mask will have the same width as the
image width.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A tf.float32 tensor of size [num_masks, image_height, image_width].</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>tf.python.framework.ops.EagerTensor</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-src.Workers">
<span id="workers"></span><h2>Workers<a class="headerlink" href="#module-src.Workers" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="src.Workers.BaseWorker">
<em class="property">class </em><code class="sig-prename descclassname">src.Workers.</code><code class="sig-name descname">BaseWorker</code><span class="sig-paren">(</span><em class="sig-param">pool</em>, <em class="sig-param">paths</em><span class="sig-paren">)</span><a class="headerlink" href="#src.Workers.BaseWorker" title="Permalink to this definition">¶</a></dt>
<dd><p>Base class for asynchronous workers. Should be subclassed, and not used as-is.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>pool</strong> (<em>multiprocessing.Pool | None</em>) – multiprocessing.Pool to apply async workers in. Can be None if <cite>config.enable_async = False</cite>.</p></li>
<li><p><strong>paths</strong> (<a class="reference internal" href="#src.io.TreeWalker.Paths" title="src.io.TreeWalker.Paths"><em>src.io.TreeWalker.Paths</em></a>) – Paths object representing the image file.</p></li>
</ul>
</dd>
</dl>
<dl class="method">
<dt id="src.Workers.BaseWorker.async_func">
<em class="property">static </em><code class="sig-name descname">async_func</code><span class="sig-paren">(</span><em class="sig-param">*args</em><span class="sig-paren">)</span><a class="headerlink" href="#src.Workers.BaseWorker.async_func" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to apply asynchronously. Implement this in subclasses.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>args</strong> (<em>list</em>) – Function arguments</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="src.Workers.BaseWorker.result_is_valid">
<code class="sig-name descname">result_is_valid</code><span class="sig-paren">(</span><em class="sig-param">result</em><span class="sig-paren">)</span><a class="headerlink" href="#src.Workers.BaseWorker.result_is_valid" title="Permalink to this definition">¶</a></dt>
<dd><p>Check that <cite>result</cite> is a valid result from <cite>self.async_func</cite>. Implement this in subclasses. Should return a
boolean.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>result</strong> – Result from <cite>async_func</cite>.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="src.Workers.BaseWorker.start">
<code class="sig-name descname">start</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#src.Workers.BaseWorker.start" title="Permalink to this definition">¶</a></dt>
<dd><p>Start the async worker. If <cite>config.enable_async = False</cite>, <cite>self.async_func</cite> will be called directly.</p>
</dd></dl>

<dl class="method">
<dt id="src.Workers.BaseWorker.get">
<code class="sig-name descname">get</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#src.Workers.BaseWorker.get" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the result from the worker.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>Return value from <cite>self.async_func</cite>.</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="src.Workers.BaseWorker.handle_error">
<code class="sig-name descname">handle_error</code><span class="sig-paren">(</span><em class="sig-param">err</em><span class="sig-paren">)</span><a class="headerlink" href="#src.Workers.BaseWorker.handle_error" title="Permalink to this definition">¶</a></dt>
<dd><p>Handle an exception raised by an async worker.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>err</strong> (<em>BaseException</em>) – Exception raised by the worker</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="src.Workers.SaveWorker">
<em class="property">class </em><code class="sig-prename descclassname">src.Workers.</code><code class="sig-name descname">SaveWorker</code><span class="sig-paren">(</span><em class="sig-param">pool</em>, <em class="sig-param">paths</em>, <em class="sig-param">img</em>, <em class="sig-param">mask_results</em><span class="sig-paren">)</span><a class="headerlink" href="#src.Workers.SaveWorker" title="Permalink to this definition">¶</a></dt>
<dd><p>Worker which saves the masked image, and archives it if archiving is enabled.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>pool</strong> (<em>multiprocessing.Pool | None</em>) – multiprocessing.Pool to apply async workers in. Can be None if <cite>config.enable_async = False</cite>.</p></li>
<li><p><strong>paths</strong> (<a class="reference internal" href="#src.io.TreeWalker.Paths" title="src.io.TreeWalker.Paths"><em>src.io.TreeWalker.Paths</em></a>) – Paths object representing the image file.</p></li>
<li><p><strong>img</strong> (<em>np.ndarray</em>) – Image to mask</p></li>
<li><p><strong>mask_results</strong> (<em>dict</em>) – Results from <cite>src.Masker.Masker.mask</cite></p></li>
</ul>
</dd>
</dl>
<dl class="method">
<dt id="src.Workers.SaveWorker.result_is_valid">
<code class="sig-name descname">result_is_valid</code><span class="sig-paren">(</span><em class="sig-param">result</em><span class="sig-paren">)</span><a class="headerlink" href="#src.Workers.SaveWorker.result_is_valid" title="Permalink to this definition">¶</a></dt>
<dd><p>Check that <cite>result</cite> is a valid result from <cite>self.async_func</cite>. Implement this in subclasses. Should return a
boolean.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>result</strong> – Result from <cite>async_func</cite>.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="src.Workers.SaveWorker.async_func">
<em class="property">static </em><code class="sig-name descname">async_func</code><span class="sig-paren">(</span><em class="sig-param">img</em>, <em class="sig-param">mask_results</em>, <em class="sig-param">paths</em>, <em class="sig-param">save_args</em>, <em class="sig-param">archive_args</em><span class="sig-paren">)</span><a class="headerlink" href="#src.Workers.SaveWorker.async_func" title="Permalink to this definition">¶</a></dt>
<dd><p>Save the result files and do archiving.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>img</strong> (<em>np.ndarray</em>) – Input image</p></li>
<li><p><strong>mask_results</strong> (<em>dict</em>) – Results from <cite>src.Masker.Masker.mask</cite>. applied to <cite>image</cite>.</p></li>
<li><p><strong>paths</strong> (<a class="reference internal" href="#src.io.TreeWalker.Paths" title="src.io.TreeWalker.Paths"><em>src.io.TreeWalker.Paths</em></a>) – Paths object representing the image file.</p></li>
<li><p><strong>save_args</strong> (<em>dict</em>) – Additional keyword-arguments to <cite>src.io.save.save_processed_img</cite></p></li>
<li><p><strong>archive_args</strong> (<em>dict</em>) – Additional keyword-arguments to <cite>src.io.save.archive</cite></p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>0</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="src.Workers.EXIFWorker">
<em class="property">class </em><code class="sig-prename descclassname">src.Workers.</code><code class="sig-name descname">EXIFWorker</code><span class="sig-paren">(</span><em class="sig-param">pool</em>, <em class="sig-param">paths</em>, <em class="sig-param">mask_results</em><span class="sig-paren">)</span><a class="headerlink" href="#src.Workers.EXIFWorker" title="Permalink to this definition">¶</a></dt>
<dd><p>Worker which reads the EXIF data from the input image using <cite>src.io.exif_util</cite>. The EXIF dict will then be written
to the specified location(s).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>pool</strong> (<em>multiprocessing.Pool | None</em>) – multiprocessing.Pool to apply async workers in. Can be None if <cite>config.enable_async = False</cite>.</p></li>
<li><p><strong>paths</strong> (<a class="reference internal" href="#src.io.TreeWalker.Paths" title="src.io.TreeWalker.Paths"><em>src.io.TreeWalker.Paths</em></a>) – Paths object representing the image file.</p></li>
<li><p><strong>mask_results</strong> (<em>dict</em>) – Results from <cite>src.Masker.Masker.mask</cite></p></li>
</ul>
</dd>
</dl>
<dl class="method">
<dt id="src.Workers.EXIFWorker.result_is_valid">
<code class="sig-name descname">result_is_valid</code><span class="sig-paren">(</span><em class="sig-param">result</em><span class="sig-paren">)</span><a class="headerlink" href="#src.Workers.EXIFWorker.result_is_valid" title="Permalink to this definition">¶</a></dt>
<dd><p>Check that <cite>result</cite> is a valid result from <cite>self.async_func</cite>. Implement this in subclasses. Should return a
boolean.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>result</strong> – Result from <cite>async_func</cite>.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="src.Workers.EXIFWorker.async_func">
<em class="property">static </em><code class="sig-name descname">async_func</code><span class="sig-paren">(</span><em class="sig-param">paths</em>, <em class="sig-param">mask_results</em>, <em class="sig-param">local_json</em>, <em class="sig-param">remote_json</em><span class="sig-paren">)</span><a class="headerlink" href="#src.Workers.EXIFWorker.async_func" title="Permalink to this definition">¶</a></dt>
<dd><p>Run the EXIF processing: Read the EXIF data, add the required fields, and save it. File exports are controlled
in <cite>config</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>paths</strong> (<a class="reference internal" href="#src.io.TreeWalker.Paths" title="src.io.TreeWalker.Paths"><em>src.io.TreeWalker.Paths</em></a>) – Paths object representing the image file.</p></li>
<li><p><strong>mask_results</strong> (<em>dict</em>) – Results from <cite>src.Masker.Masker.mask</cite></p></li>
<li><p><strong>local_json</strong> (<em>bool</em>) – Write JSON file to the input (local) directory?</p></li>
<li><p><strong>remote_json</strong> (<em>bool</em>) – Write JSON file to the output (remote) directory?</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>EXIF dict written to the specified locations</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">API Reference</a><ul>
<li><a class="reference internal" href="#module-config">config</a></li>
<li><a class="reference internal" href="#db">db</a><ul>
<li><a class="reference internal" href="#module-src.db.DatabaseClient">db.DatabaseClient</a></li>
<li><a class="reference internal" href="#module-src.db.formatters">db.formatters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#io">io</a><ul>
<li><a class="reference internal" href="#module-src.io.exif_util">io.exif_util</a></li>
<li><a class="reference internal" href="#module-src.io.load">io.load</a></li>
<li><a class="reference internal" href="#module-src.io.save">io.save</a></li>
<li><a class="reference internal" href="#module-src.io.tf_dataset">io.tf_dataset</a></li>
<li><a class="reference internal" href="#module-src.io.TreeWalker">io.TreeWalker</a></li>
<li><a class="reference internal" href="#module-src.io.file_access_guard">io.file_access_guard</a></li>
<li><a class="reference internal" href="#module-src.io.file_checker">io.file_checker</a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-src.email_sender">email_sender</a></li>
<li><a class="reference internal" href="#module-src.ImageProcessor">ImageProcessor</a></li>
<li><a class="reference internal" href="#module-src.main">main</a></li>
<li><a class="reference internal" href="#module-src.Masker">Masker</a></li>
<li><a class="reference internal" href="#module-src.Workers">Workers</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="readme.html"
                        title="previous chapter">README</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/api-reference.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="readme.html" title="README"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Image-anonymisation 0 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Daniel Johansen Trosten, Christian Skjetne.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.4.4.
    </div>
  </body>
</html>