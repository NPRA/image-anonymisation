
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>README &#8212; Image-anonymisation 0 documentation</title>
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="API Reference" href="api-reference.html" />
    <link rel="prev" title="Welcome to Image-anonymisation’s documentation!" href="index.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="api-reference.html" title="API Reference"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Welcome to Image-anonymisation’s documentation!"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Image-anonymisation 0 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="readme">
<h1>README<a class="headerlink" href="#readme" title="Permalink to this headline">¶</a></h1>
<div class="section" id="image-anonymisation">
<h2>image-anonymisation<a class="headerlink" href="#image-anonymisation" title="Permalink to this headline">¶</a></h2>
<p>Using pre-trained TensorFlow models to remove vehicles and people from images</p>
<div class="section" id="getting-started">
<h3>Getting started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h3>
<div class="section" id="clone-or-download-the-code">
<h4>Clone or download the code<a class="headerlink" href="#clone-or-download-the-code" title="Permalink to this headline">¶</a></h4>
<p><strong>Option 1 - With Git:</strong>
<code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">https://github.com/NPRA/image-anonymisation.git</span></code> (Requires <code class="docutils literal notranslate"><span class="pre">git</span></code> to be installed)</p>
<p><strong>Option 2 - Manual download:</strong>
Select “Clone or download” and “Download ZIP” above. Then extract the downloaded archive to a suitable
location.</p>
</div>
<div class="section" id="installing-build-tools-for-visual-studio-2019">
<h4>Installing Build Tools for Visual Studio 2019<a class="headerlink" href="#installing-build-tools-for-visual-studio-2019" title="Permalink to this headline">¶</a></h4>
<p>Build Tools for Visual Studio 2019 is required to build some of the package-dependencies.</p>
<ol class="arabic simple">
<li><p>Download the <a class="reference external" href="https://visualstudio.microsoft.com/thank-you-downloading-visual-studio/?sku=BuildTools&amp;rel=16">installer</a>.</p></li>
<li><p>Run the installer as Administrator</p></li>
<li><p>Select “C++ build tools” during installation.</p></li>
</ol>
</div>
<div class="section" id="installing-anaconda">
<h4>Installing Anaconda<a class="headerlink" href="#installing-anaconda" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><p>Download the <a class="reference external" href="https://www.anaconda.com/distribution/">installer</a>.</p></li>
<li><p>Run installer as Administrator.</p></li>
<li><p>Select “Install for all users” during installation.</p></li>
</ol>
</div>
<div class="section" id="creating-the-conda-environment">
<h4>Creating the conda-environment<a class="headerlink" href="#creating-the-conda-environment" title="Permalink to this headline">¶</a></h4>
<ol class="arabic">
<li><p>Open an “Anaconda PowerShell Prompt” as Administrator.</p></li>
<li><p>In the Anaconda PowerShell Prompt, navigate to the root directory of the cloned repository.</p></li>
<li><p>Create the conda-environment by running:</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>conda env create -f environment.yml
</pre></div>
</div>
<p>This will create a new environment named <code class="docutils literal notranslate"><span class="pre">image-anonymisation</span></code>.</p>
</li>
<li><p>Activate the environment by running:</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>conda activate image-anonymisation
</pre></div>
</div>
</li>
<li><p>Install <code class="docutils literal notranslate"><span class="pre">pycocotools</span></code>:</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>pip install git+https://github.com/philferriere/cocoapi.git#subdirectory<span class="o">=</span>PythonAPI
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="proxy-setup">
<h4>Proxy setup<a class="headerlink" href="#proxy-setup" title="Permalink to this headline">¶</a></h4>
<p>If Anaconda fails to create the environment above due to a HTTP error, you might need to configure Anaconda to use
a proxy:</p>
<ol class="arabic">
<li><p>Add <code class="docutils literal notranslate"><span class="pre">HTTPS_PROXY=&lt;your_proxy&gt;</span></code> to the system environment variables.</p></li>
<li><p>In <code class="docutils literal notranslate"><span class="pre">~/.condarc</span></code> add the following lines:</p>
<div class="highlight-guess notranslate"><div class="highlight"><pre><span></span><span class="c">proxy_servers:</span>
<span class="c">    https: &lt;your_proxy&gt;</span>
</pre></div>
</div>
</li>
<li><p>You should now be able to create the conda environment with:</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>conda env create -f environment.yml
</pre></div>
</div>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">pip</span></code>-part of the installation will fail, but the conda packages will be installed.</p>
</li>
<li><p>Activate the environment:</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>conda activate image-anonymisation
</pre></div>
</div>
</li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">pip</span></code>-packages will now have to be installed manually:</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>pip install opencv-python<span class="o">==</span><span class="m">4</span>.2.0.32 <span class="nv">pillow</span><span class="o">==</span><span class="m">7</span>.0.0 --proxy &lt;your_proxy&gt;
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">webp</span></code> package requires a little more trickery. First, install <code class="docutils literal notranslate"><span class="pre">importlib_resources</span></code> and <code class="docutils literal notranslate"><span class="pre">conan</span></code>:</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>pip install importlib_resources&gt;<span class="o">=</span><span class="m">1</span>.0.0  conan&gt;<span class="o">=</span><span class="m">1</span>.8.0 --proxy &lt;your_proxy&gt;
</pre></div>
</div>
<p>Now, <code class="docutils literal notranslate"><span class="pre">conan</span></code> has to be configured to use the proxy server. In <code class="docutils literal notranslate"><span class="pre">~/.conan/conan.conf</span></code> under <code class="docutils literal notranslate"><span class="pre">[proxies]</span></code>, add the lines:</p>
<div class="highlight-guess notranslate"><div class="highlight"><pre><span></span>http = &lt;your_proxy&gt;
https = &lt;your_proxy&gt;
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">webp</span></code> package can now be installed with</p>
<div class="highlight-guess notranslate"><div class="highlight"><pre><span></span>pip install webp==0.1.0a15 --proxy &lt;your_proxy&gt;
</pre></div>
</div>
</li>
</ol>
</div>
</div>
<div class="section" id="usage">
<h3>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h3>
<p>The program will traverse the file-tree rooted at the input folder, and mask all .jpg images within the tree. The masked
images will be written to an output directory with identical structure as the input folder. The program should be
executed as a python-module from the root directory:</p>
<div class="highlight-guess notranslate"><div class="highlight"><pre><span></span><span class="c">usage: python -m src.main [-h] [-i INPUT_FOLDER] [-o OUTPUT_FOLDER] [-a ARCHIVE_FOLDER]</span>

Image anonymisation

optional arguments:
  -h, --help            show this help message and exit
  -i INPUT_FOLDER, --input-folder INPUT_FOLDER
                        Base directory for input images.
  -o OUTPUT_FOLDER, --output-folder OUTPUT_FOLDER
                        Base directory for masked (output) images and metadata
                        files
  -a ARCHIVE_FOLDER, --archive-folder ARCHIVE_FOLDER
                        Base directory for archiving original images.
</pre></div>
</div>
<p>Note: Make sure that the conda environment is activated before executing the command above.</p>
<div class="section" id="batch-script-and-powershell-script">
<h4>Batch script and PowerShell script.<a class="headerlink" href="#batch-script-and-powershell-script" title="Permalink to this headline">¶</a></h4>
<p>The anonymisation can be ran without manually activating the conda environment, by running either <code class="docutils literal notranslate"><span class="pre">bin/run-with-prompt.bat</span></code> or <code class="docutils literal notranslate"><span class="pre">bin/run.ps1</span></code>.
The latter also works when conda is not initialized in the shell, as long as the <code class="docutils literal notranslate"><span class="pre">conda_path</span></code> parameter is specified correctly.</p>
</div>
<div class="section" id="additional-configuration">
<h4>Additional configuration<a class="headerlink" href="#additional-configuration" title="Permalink to this headline">¶</a></h4>
<p>Additional configuration variables are listed in <code class="docutils literal notranslate"><span class="pre">config.py</span></code>.</p>
</div>
</div>
<div class="section" id="documentation">
<h3>Documentation<a class="headerlink" href="#documentation" title="Permalink to this headline">¶</a></h3>
<p>The HTML documentation can be built from the <code class="docutils literal notranslate"><span class="pre">docs</span></code> directory by running</p>
<div class="highlight-guess notranslate"><div class="highlight"><pre><span></span>.\make.bat html
</pre></div>
</div>
</div>
<div class="section" id="email-notifications">
<h3>Email notifications<a class="headerlink" href="#email-notifications" title="Permalink to this headline">¶</a></h3>
<p>The application can send an email notification on an abnormal exit, a processing error, or on completion. These noticifations can be enabled/disabled
with the flags <code class="docutils literal notranslate"><span class="pre">uncaught_exception_email</span></code>, <code class="docutils literal notranslate"><span class="pre">processing_error_email</span></code> and <code class="docutils literal notranslate"><span class="pre">finished_email</span></code>, available in <code class="docutils literal notranslate"><span class="pre">config.py</span></code>. The email sending feature requires a
sender, receiver(s), and an SMTP-server in order to work. These can be specified by creating a file named <code class="docutils literal notranslate"><span class="pre">email_config.py</span></code> in the project root, which
contains the following:</p>
<div class="highlight-guess notranslate"><div class="highlight"><pre><span></span># Sender&#39;s address
from_address = &quot;noreply@somedomain.com&quot;
# Receiver address(es)
to_addresses = [&quot;receiver1@domain.com&quot;, &quot;receiver2@domain.com, ...]
# SMTP-server address
smtp_host = &lt;smtp server address&gt;
# SMTP-server port
port = &lt;smtp port&gt;
</pre></div>
</div>
</div>
<div class="section" id="exif-data-to-database">
<h3>EXIF data to database<a class="headerlink" href="#exif-data-to-database" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">src.db</span></code> module can write the EXIF data extracted by the application, to an Oracle database. The username, password and dsn used to access the database
must be specified in <code class="docutils literal notranslate"><span class="pre">src/db/db_config.py</span></code>:</p>
<div class="highlight-guess notranslate"><div class="highlight"><pre><span></span>user = &lt;username&gt;
pwd = &lt;password&gt;
dsn = &lt;dsn&gt;
# Set this parameter if you want to use a table within a specific schema.
schema = None
# Name of the table
table_name = &lt;table name&gt;
</pre></div>
</div>
<p>When the parameters above have been configured correctly, the EXIF data can be written to the database by using the <code class="docutils literal notranslate"><span class="pre">json_to_db</span></code> script:</p>
<div class="highlight-guess notranslate"><div class="highlight"><pre><span></span>python -m src.db.json_to_db -i &lt;base input folder&gt;
</pre></div>
</div>
<p>This will recursively traverse <code class="docutils literal notranslate"><span class="pre">&lt;base</span> <span class="pre">input</span> <span class="pre">folder&gt;</span></code>, read all .json files, and write the contents to the specified database.</p>
<p>Database writing can also be done automatically during anonymisation. This is enabled by setting <code class="docutils literal notranslate"><span class="pre">write_exif_to_db</span> <span class="pre">=</span> <span class="pre">True</span></code> in <code class="docutils literal notranslate"><span class="pre">config.py</span></code>.</p>
<p>WARNING: Currently, the EXIF header will be written to the database even if image postprocessing failed. It is therefore recommended to use
the <code class="docutils literal notranslate"><span class="pre">json_to_db</span></code> script instead.</p>
</div>
<div class="section" id="evaluating-the-current-model">
<h3>Evaluating the current model<a class="headerlink" href="#evaluating-the-current-model" title="Permalink to this headline">¶</a></h3>
<p>The anonymisation model can be evaluated by running the evaluation script:</p>
<div class="highlight-guess notranslate"><div class="highlight"><pre><span></span><span class="c">usage: python -m src.evaluate [-h] [-i INPUT_FOLDER] [-a ANNOTATION_FILE] [--accumulate]</span>

Evaluate the anonymisation model.

optional arguments:
  -h, --help            show this help message and exit
  -i INPUT_FOLDER, -input-folder INPUT_FOLDER
                        Base directory of images to use for evaluation.
  -a ANNOTATION_FILE, -annotation-file ANNOTATION_FILE
                        Path to a .json file containing the ground-truth
                        annotations. The file must be formatted according to
                        the COCO annotation file guidelines.
  --accumulate          Accumulate the results for all images?
</pre></div>
</div>
<p>Note that the annotations for the evaluation dataset must be on the <a class="reference external" href="http://cocodataset.org/#format-data">COCO format</a>.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">README</a><ul>
<li><a class="reference internal" href="#image-anonymisation">image-anonymisation</a><ul>
<li><a class="reference internal" href="#getting-started">Getting started</a><ul>
<li><a class="reference internal" href="#clone-or-download-the-code">Clone or download the code</a></li>
<li><a class="reference internal" href="#installing-build-tools-for-visual-studio-2019">Installing Build Tools for Visual Studio 2019</a></li>
<li><a class="reference internal" href="#installing-anaconda">Installing Anaconda</a></li>
<li><a class="reference internal" href="#creating-the-conda-environment">Creating the conda-environment</a></li>
<li><a class="reference internal" href="#proxy-setup">Proxy setup</a></li>
</ul>
</li>
<li><a class="reference internal" href="#usage">Usage</a><ul>
<li><a class="reference internal" href="#batch-script-and-powershell-script">Batch script and PowerShell script.</a></li>
<li><a class="reference internal" href="#additional-configuration">Additional configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#documentation">Documentation</a></li>
<li><a class="reference internal" href="#email-notifications">Email notifications</a></li>
<li><a class="reference internal" href="#exif-data-to-database">EXIF data to database</a></li>
<li><a class="reference internal" href="#evaluating-the-current-model">Evaluating the current model</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Welcome to Image-anonymisation’s documentation!</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="api-reference.html"
                        title="next chapter">API Reference</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/readme.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="api-reference.html" title="API Reference"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Welcome to Image-anonymisation’s documentation!"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Image-anonymisation 0 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Daniel Johansen Trosten, Christian Skjetne.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.4.4.
    </div>
  </body>
</html>